<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:pxt="http://www.peixoto.com.br/pxtFaces"
	xmlns:pxtfl="http://www.peixoto.com.br/jsf" xmlns:pxtfc="http://www.peixoto.com.br/jsf/core">
	
<rich:panel id="produtoPanel">
	<rich:toolbar height="26px" separator="line">
		<h:panelGroup rendered="#{!pedidoDiversoBean.importarViaSaldao() and !pedidoDiversoBean.verificaTipoPedidoInventario}">
			<ui:include src="/pedido/pedidoDiverso/searchField/searchProduto.xhtml"/>
		</h:panelGroup>
		<h:panelGroup rendered="#{pedidoDiversoBean.importarViaSaldao()}">
			<a4j:commandButton value="Adicionar" title="Adicionar itens a partir do bloqueio" 
			render="slcTpPedido,slcFormPag,slcFilFat,slcFilEtq,slcBloqueio,iptNumPedVnd,tabelaProdutos,panelCadastro,mensagemGeral,messagePane,searchPessoa,@this" styleClass="btnToolbar" 
			style="background:transparent url(#{facesContext.externalContext.requestContextPath}/resources/img/search2_16x16.png) no-repeat left"  
			disabled="#{pedidoDiversoBean.desabilitaSearchFieldProdutos}" rendered="#{pedidoDiversoBean.importarViaSaldao()}" actionListener="#{pedidoDiversoBean.buscarItensPorBloqueio}"/>
		</h:panelGroup>
		<h:panelGroup rendered="#{pedidoDiversoBean.verificaTipoPedidoInventario}">
			<a4j:commandButton value="Adicionar" title="Adicionar itens a partir do inventário" 
			render="slcTpPedido,slcFormPag,slcFilFat,slcFilEtq,slcBloqueio,iptNumPedVnd,tabelaProdutos,panelCadastro,mensagemGeral,messagePane,searchPessoa,iptNumInv,@this" styleClass="btnToolbar" 
			style="background:transparent url(#{facesContext.externalContext.requestContextPath}/resources/img/search2_16x16.png) no-repeat left"  
			disabled="#{pedidoDiversoBean.desabilitaSearchFieldProdutos}" rendered="#{pedidoDiversoBean.verificaTipoPedidoInventario}" 
			actionListener="#{pedidoDiversoBean.buscarItensPorInventario}"/>
		</h:panelGroup>
	</rich:toolbar>
	
	<rich:panel id="tabPanelItens" bodyClass="pxt-rich-body-panel-detail zeroBodySpace">
		<rich:dataTable id="tabelaProdutos" var="item" rowClasses="pxt-odd-row, pxt-even-row"
			value="#{pedidoDiversoBean.listaProdutosDatatable}" styleClass="stable" footerClass="pxt-rf-dt-ftr-c" rowKeyVar="keyVar"
			rows="14" render="tabelaProdutosScroller">
			<ui:param name="columnGroupId" value="tabelaProdutos" />

			<pxtfl:column headerValue="Código" value="#{item.codigoProduto}" textAlign="center"/>
			<pxtfl:column headerValue="Descrição" value="#{item.descricaoProduto != null ? item.descricaoProduto : ''}" />
			<rich:column value="#{item.quantidadeExpedicao != null ? item.quantidadeExpedicao : ''}" id="qdeExpedicao">
				<f:facet name="header">
					<h:outputText value="Quantidade" />
				</f:facet>
				<h:inputText value="#{item.quantidadeExpedicao}" maxlength="6" style="background: none; text-align: center; text-align: center; width: 100%; border-style:solid; border-color:#85ADE5; border-radius:3px;" 
				disabled="#{pedidoDiversoBean.disabledOnDefault or pedidoDiversoBean.importarViaSaldao() or pedidoDiversoBean.verificaTipoPedidoInventario or pedidoDiversoBean.verificaTipoPedidoReclassificacao}" >
					<pxt:onlyNumber/>
					<a4j:ajax event="change" render="tabelaProdutos,total,valorUnitario,volumeTotal,pesoTotal" execute="@all" listener="#{pedidoDiversoBean.atualizaTotal}" />
				</h:inputText>
			</rich:column>
			
			<rich:column value="#{item.preco}">
				<f:facet name="header">
					<h:outputText value="Valor Unitário" />
				</f:facet>
				<h:inputText value="#{item.preco}" id="valorUnitario" style="background: none; text-align: center; text-align: center; width: 100%; border-style:solid; border-color:#85ADE5; border-radius:3px;" converter="moedaConverter" 
				disabled="#{pedidoDiversoBean.pedidoDiversoSupport.tipoPedido.tipoPreco ne 'M' or pedidoDiversoBean.verificaTipoPedidoReclassificacao}">
					<a4j:ajax event="change" render="tabelaProdutos,total,pesoTotal,volumeTotal" execute="@all" listener="#{pedidoDiversoBean.atualizaTotal}"/>
					<pxt:onlyNumber/>
				</h:inputText>
			</rich:column>
			<pxtfl:column headerValue="Peso Total" id="pesoTotal" value="#{item.pesoProdutoTotal}"  textAlign="center" footerValue="#{pedidoDiversoBean.pesoTotal}"/>
			<pxtfl:column headerValue="Volume Total" id="volumeTotal" value="#{item.volumeProdutoTotal}"  textAlign="center" footerValue="#{pedidoDiversoBean.volumeTotal}"/>
			<pxtfl:column headerValue="Deposito" id="deposito" value="#{item.codigoDeposito}"  textAlign="center"/>
			<pxtfl:column headerValue="Total" value="#{item.valorTotal != null ? item.valorTotal: ''}" textAlign="center" id="total" footerValue="#{pedidoDiversoBean.valorTotal}" typeFormat="currency"/>
			<pxtfl:column headerValue="Observação" value="#{item.observacao != null ? item.observacao: ''}" textAlign="center" footerValue="Número de Itens: #{pedidoDiversoBean.listaProdutosDatatable.size()}"/>
			<rich:column style="width: 1px;" exportColumn="false">
				<a4j:commandLink execute="@this" render="confirmPane"
					disabled="#{(pedidoDiversoBean.estadoCrud != 'ST_INSERT' and pedidoDiversoBean.estadoCrud != 'ST_EDIT') or pedidoDiversoBean.verificaTipoPedidoInventario}"
					oncomplete="#{rich:component('confirmPane')}.show()" >
					<f:param name="VALIDATION_OFF" value="true" />
					<f:param name="confirmTitle" value="Deseja mesmo remover este item?" />
					<f:param name="confirmFunction" value="removePedidoDiverso()" />
					<f:setPropertyActionListener value="#{item}" target="#{pedidoDiversoBean.domain}"/>
					<h:graphicImage title="Excluir o registro!" name="excluir_16x16.png" library="pxt.framework.faces.img" style="border-width: 0px;" />
				</a4j:commandLink>
			</rich:column>

			<f:facet name="footer">
				<rich:dataScroller id="tabelaProdutosScroller" renderIfSinglePage="false" align="left" render="tabelaProdutos" />
			</f:facet>
		</rich:dataTable>

		<a4j:jsFunction name="removePedidoDiverso" render="tabelaProdutos, mensagemGeral, messagePane" execute="@this"
			oncomplete="#{rich:component('confirmPane')}.hide();" actionListener="#{pedidoDiversoBean.removePedidoDiverso}" />
	</rich:panel>
</rich:panel>

<rich:popupPanel id="popupProdutos" modal="true" resizeable="false" left="285" top="100" zindex="105" height="465" width="800" header="Pesquisa de Produtos" style="padding: 0;" domElementAttachment="parent">
	<f:facet name="controls">
		<h:outputLink style="vertical-align: middle;" title="Fechar" onclick="#{rich:component('popupProdutos')}.hide(); return false;" >
			<h:graphicImage alt="X"	value="#{facesContext.externalContext.requestContextPath}/faces/javax.faces.resource/fechar_14x14.png?ln=pxt.framework.faces.img" />
		</h:outputLink>
	</f:facet>
</rich:popupPanel>	

</html>